<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ì²´ í˜„í™© ëª¨ë‹ˆí„°</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    .header { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
    button { padding: 8px 16px; margin: 5px 5px 10px 0; }
    input[type="date"] { padding: 8px; margin: 5px 10px 5px 0; }
  </style>
</head>
<body>
  <div class="header">ì „ì²´ ì‚¬ìš©ì ì‘ì—… í˜„í™©</div>

  <label>ë‚ ì§œ ì„ íƒ: <input type="date" id="dateFilter" onchange="loadData()" /></label>

  <table id="dataTable">
    <thead>
      <tr>
        <th>ì„ íƒ</th>
        <th>#</th>
        <th>ì´ë¦„</th>
        <th>ë¼ì¸</th>
        <th>ìŠ¤íƒ€ì¼</th>
        <th>ê°œìˆ˜</th>
        <th>ë“±ë¡ì‹œê°„</th>
      </tr>
    </thead>
    <tbody id="dataBody">
      <!-- ë°ì´í„° ìë™ ì‚½ì… -->
    </tbody>
  </table>

  <button onclick="deleteSelected()">âœ… ì„ íƒ í•­ëª© ì‚­ì œ</button>
  <button onclick="clearAll()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
  <button onclick="exportToExcel()">ğŸ“¥ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ</button>

  <script>
    function formatDateToYYYYMMDD(dateString) {
      const d = new Date(dateString);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
  }

    function loadData() {
      const dataBody = document.getElementById("dataBody");
      const selectedDate = document.getElementById("dateFilter").value;
      dataBody.innerHTML = "";

      const allData = JSON.parse(localStorage.getItem("workRecords")) || [];

      allData.forEach((record, index) => {
        const recordDate = record.timestamp.split(" ")[0]; // ì´ë¯¸ "YYYY-MM-DD" í˜•ì‹ì„

      

        if (!selectedDate || recordDate === selectedDate) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td><input type="checkbox" class="rowCheckbox" data-index="${index}"></td>
            <td>${index + 1}</td>
            <td>${record.name}</td>
            <td>Line ${record.line}</td>
            <td>${record.style}</td>
            <td>${record.quantity}</td>
            <td>${record.timestamp}</td>
          `;
          dataBody.appendChild(row);
        }
      });
    }

    function deleteSelected() {
      const checkboxes = document.querySelectorAll(".rowCheckbox:checked");
      if (checkboxes.length === 0) {
        alert("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }

      let allData = JSON.parse(localStorage.getItem("workRecords")) || [];
      const indicesToRemove = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));

      // ì¸ë±ìŠ¤ ì—­ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ì œê±°
      indicesToRemove.sort((a, b) => b - a).forEach(i => allData.splice(i, 1));

      localStorage.setItem("workRecords", JSON.stringify(allData));
      loadData();
    }

    function clearAll() {
      if (confirm("ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        localStorage.removeItem("workRecords");
        loadData();
      }
    }

    function exportToExcel() {
      const table = document.getElementById("dataTable");
      const wb = XLSX.utils.table_to_book(table, { sheet: "ì‘ì—…í˜„í™©" });
      XLSX.writeFile(wb, "ì‘ì—…í˜„í™©.xlsx");
    }

    loadData();
  </script>
</body>
</html>
